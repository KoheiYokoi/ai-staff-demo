<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
      <title>AIデンタルクリニック</title>
      <style>
      /* --- Chat Widget CSS (追加分) --- */
.chat-window {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    background: #f9f9f9;
    border-radius: var(--border-radius);
    overflow: hidden;
}
.chat-messages {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 15px;
}
.message {
    max-width: 80%;
    padding: 10px 15px;
    border-radius: 15px;
    font-size: 0.9rem;
    line-height: 1.4;
}
.message.bot {
    align-self: flex-start;
    background: #fff;
    border: 1px solid #ddd;
    border-bottom-left-radius: 2px;
}
.message.user {
    align-self: flex-end;
    background: var(--primary-color);
    color: #fff;
    border-bottom-right-radius: 2px;
}
.chat-input-area {
    padding: 15px;
    background: #fff;
    border-top: 1px solid #eee;
    display: flex;
    gap: 10px;
}
.chat-input-area input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    outline: none;
}
.chat-input-area button {
    padding: 0 20px;
    background: var(--primary-color);
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}
.chat-input-area button:disabled {
    background: #ccc;
}
      </style>
    </head>

    <body>
      <div class="demo-image" style="background: none; border: 1px solid #eee;">
    <div class="chat-window">
        <div class="chat-messages" id="chat-messages">
            <div class="message bot">こんにちは！AIデンタルクリニックです。<br>診療時間や予約についてご質問ですか？</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="user-input" placeholder="質問を入力... (例: 土曜はやってる？)">
            <button id="send-btn" onclick="sendMessage()"><i class="material-icons">send</i></button>
        </div>
    </div>
</div>
    </body>
  <script>
    const chatMessages = document.getElementById('chat-messages');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');

    // Enterキーでも送信できるようにする
    userInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    async function sendMessage() {
        const text = userInput.value.trim();
        if (!text) return;

        // 1. ユーザーのメッセージを表示
        addMessage(text, 'user');
        userInput.value = '';
        userInput.disabled = true;
        sendBtn.disabled = true;

        try {
            // 2. ローディング表示（簡易的）
            const loadingId = addMessage('考え中...', 'bot', true);

            // 3. APIサーバーへ送信
            const response = await fetch('https://ai-staff-api.onrender.com/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: text })
            });

            const data = await response.json();

            // 4. ローディングを消してAIの回答を表示
            removeMessage(loadingId);
            addMessage(data.reply, 'bot');

        } catch (error) {
            console.error('Error:', error);
            addMessage('エラーが発生しました。サーバーが起動しているか確認してください。', 'bot');
        } finally {
            userInput.disabled = false;
            sendBtn.disabled = false;
            userInput.focus();
        }
    }

    function addMessage(text, sender, isLoading = false) {
        const div = document.createElement('div');
        div.classList.add('message', sender);
        div.innerHTML = text.replace(/\n/g, '<br>'); // 改行コードをHTMLタグに変換
        
        // ローディング用ID付与
        const id = 'msg-' + Date.now();
        div.id = id;
        
        chatMessages.appendChild(div);
        chatMessages.scrollTop = chatMessages.scrollHeight; // 一番下へスクロール
        return id;
    }

    function removeMessage(id) {
        const el = document.getElementById(id);
        if (el) el.remove();
    }
</script>
</html>
